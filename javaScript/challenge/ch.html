<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Data Pengajuan Leasing</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 8px 12px;
      border: 1px solid #ddd;
    }

    th {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>

  <h1>Data Pengajuan Leasing</h1>

    <table id="tabelPengajuan">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Umur</th>
        <th>DP</th>
        <th>Harga Motor</th>
      </tr>
    </thead>
    <tbody>
      <!-- Data akan dimasukkan ke sini -->
    </tbody>
  </table>

  <h2>List Pengajuan dengan Umur 21-55</h2>

  <table id="tabelUmur">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Umur</th>
        <th>DP</th>
        <th>Harga Motor</th>
      </tr>
    </thead>
    <tbody>
      <!-- Data akan dimasukkan ke sini -->
    </tbody>
  </table>

    <h3>Hitung Cicilan Bulanan Umur 25-55</h3>
    <table id="tabelCicilanUmur">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Umur</th>
        <th>Cicilan Bulanan</th>
      </tr>
    </thead>
    <tbody>
      <!-- Data akan dimasukkan ke sini -->
    </tbody>
  </table>

  <!-- Script untuk mengambil data dari API dan menampilkannya di tabel -->
  <script>
    async function tampilkanData() {
      try {
        const res = await fetch("https://68598a7a138a18086dfec989.mockapi.io/dummy-fif/DummyDataUser");
        console.log('res: ', res)
        const data = await res.json();
        console.log('Data: ', data)

        const tbody = document.querySelector("#tabelPengajuan tbody");
        tbody.innerHTML = ""; // kosongkan dulu

        data.forEach((pengajuan, index) => {
          const row = `
            <tr>
              <td>${index + 1}</td>
              <td>${pengajuan.name}</td>
              <td>${pengajuan.age}</td>
              <td>Rp ${parseInt(pengajuan.dp).toLocaleString()}</td>
              <td>Rp ${parseInt(pengajuan.price).toLocaleString()}</td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      } catch (err) {
        console.error("Gagal mengambil data:", err);
      }
    }
    
    async function tampilkanDataUmur() {
      try {
        const res = await fetch("https://68598a7a138a18086dfec989.mockapi.io/dummy-fif/DummyDataUser");
        const data = await res.json();
    
        const tbody = document.querySelector("#tabelUmur tbody");
        tbody.innerHTML = ""; // kosongkan dulu

        const tes = data.filter(pengajuan => pengajuan.age >= 25 && pengajuan.age <= 55);
    
        tes.forEach((pengajuan, index) => {
          if (pengajuan.age >= 21 && pengajuan.age <= 55) {
            const row = `
              <tr>
                <td>${index + 1}</td>
                <td>${pengajuan.name}</td>
                <td>${pengajuan.age}</td>
                <td>Rp ${parseInt(pengajuan.dp).toLocaleString()}</td>
                <td>Rp ${parseInt(pengajuan.price).toLocaleString()}</td>
              </tr>
            `;
            tbody.innerHTML += row;
          }
        });
      } catch (err) {
        console.error("Gagal mengambil data:", err);
      }
    }


    async function hitungCicilanBulanan() {
      try {
        const res = await fetch("https://68598a7a138a18086dfec989.mockapi.io/dummy-fif/DummyDataUser");
        const data = await res.json();

        const tbody = document.querySelector("#tabelCicilanUmur tbody");
        tbody.innerHTML = ""; // kosongkan dulu

        const tes = data.filter(pengajuan => pengajuan.age >= 25 && pengajuan.age <= 55);

        tes.forEach((pengajuan, index) => {
            const hargaMotor = parseFloat(pengajuan.price);
            const dp = parseFloat(hargaMotor * 0.3); // Uang muka minimal 30%
            const tenor = 12; // 12 bulan
            const bungaInput = 10; // 10% per tahun
            
            const pinjaman = hargaMotor - dp;
            const bunga = (bungaInput / 100) / 12; // Bunga per bulan
            const totalPembayaran = pinjaman * (1 + bunga * tenor); // Total pembayaran
            const cicilanBulanan = totalPembayaran / tenor;

            const row = `
              <tr>
                <td>${index + 1}</td>
                <td>${pengajuan.name}</td>
                <td>${pengajuan.age}</td>
                <td>Rp ${Math.round(cicilanBulanan).toLocaleString()}</td>
              </tr>
            `;
            tbody.innerHTML += row;
        });
      } catch (err) {
        console.error("Gagal mengambil data:", err);
      }
    }

    // Panggil fungsi otomatis saat halaman selesai dimuat
    document.addEventListener("DOMContentLoaded", () => {tampilkanData(); tampilkanDataUmur(); hitungCicilanBulanan();});
  </script>

</body>
</html>